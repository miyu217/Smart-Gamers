<main>
  <p id="notice"><%= flash[:notice] %></p>
  <div class="container px-5 px-sm-0">
    <h1 class="heading-custom" data-en="Review">レビュー</h1>
    <div class="row">
      <div class="col-md-3">
        <div class="new-review">
          <%= form_with(model:[@game, @review], local: true) do |f| %>
          <div class="form-review-group">
            <h3 class="game_opinion list-back">New Review</h3>
            <div class="radiobox">
                <%= f.radio_button :rating, "5", class: 'radiobutton' %>
              <label for="review_rating_5"><i class="fa-solid fa-face-laugh-squint"> Excellent</i></label>
                <%= f.radio_button :rating, "4", class: 'radiobutton' %>
              <label for="review_rating_4"><i class="fa-solid fa-face-smile"> Good</i></label>
                <%= f.radio_button :rating, "3", class: 'radiobutton' %>
              <label for="review_rating_3"><i class="fa-solid fa-face-meh"> Average</i></label>
                <%= f.radio_button :rating, "2", class: 'radiobutton' %>
              <label for="review_rating_2"><i class="fa-solid fa-face-frown-open"> Below Average</i></label>
                <%= f.radio_button :rating, "1", class: 'radiobutton' %>
              <label for="review_rating_1"><i class="fa-solid fa-face-sad-tear"> Poor</i></label>
            </div>
          <div class="form-group">
            <%= f.text_area :comment, class: 'form-control',placeholder: "感想、コメントを記入" %>
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-block btn-success">レビューを送信</button>
          </div>
          <% end %>
        </div>
      </div>

      <div class="col-md-6">
        <section class="search">
          <div class="search-form-custom mt-3">
            <%= form_tag(search_path, method: "get", class: "form-inline") do %>
            <div class="input-group">
              <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "ゲームを検索" %>
              <div class="input-group-append">
                <button class="btn btn-search-custom text-light" type="submit"><i class="fa fa-search"></i></button>
              </div>
            </div>
            <% end %>
          </div>
        </section>
        <section class="game-review section-back mt-3">
        <h3 class="h-min"><%= link_to @game.title, game_path(@game) %></h3>

          ジャンル：<%= @game.genre %>
              <%= @game.status %>
              <%= @game.price %>
              <%= @game.developer %>
              <%= @game.release_date %>

                <% if current_user %>
                  <% if current_user.favorites.exists?(game: @game) %>
                    <%= link_to game_favorite_path(@game), method: :delete, class: "btn btn-favorite-d-custom" do %>
                    <i class="fa-solid fa-heart"></i>
                    <% end %>
                  <% else %>
                    <%= link_to game_favorites_path(@game), method: :post, class: "btn btn-favorite-custom" do %>
                    <i class="fa-regular fa-heart"></i>
                    <% end %>
                  <% end %>
                <% end %>

        </section>
      </div>
    </div>
    <div class="col-md-3">
      <section class="search section-back mt-3">
      <h3 class="font-al">Game's Review</h3>
        <% if @reviews.any? %>
          <% @reviews.each do |review| %>
                  <%= display_rating_icon(review.rating) %>
                  <br><%= review.comment %>
                  <br>
                  <%= review.user.name %>
                  _ <%= review.created_at.strftime('%Y/%m/%d') %>
            <% end %>
            <% else %>
            レビューはまだありません。
            <% end %>
          </section>
        </div>
</main>