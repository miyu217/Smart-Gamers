<main>
  <p id="notice"><%= flash[:notice] %></p>
  <div class="container px-5 px-sm-0">
    <h1 class="heading-custom" data-en="Review">レビュー</h1>
    <div class="row">
      <div class="col-md-6">
        <section class="search mt-3">
          <div class="search-form-custom">
            <%= form_tag(search_path, method: "get", class: "form-inline") do %>
            <div class="input-group">
              <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "ゲームを検索" %>
              <div class="input-group-append">
                <button class="btn btn-search-custom text-light" type="submit"><i class="fa fa-search"></i></button>
              </div>
            </div>
            <% end %>
          </div>
        </section>
        <section class="game-date section-back mt-3">
          <h3 class="ml-2 font-jp"><%= link_to @game.title, game_path(@game) %></h3>
          <div>
            <% if current_user %>
              <% if current_user.favorites.exists?(game: @game) %>
                <%= link_to game_favorite_path(@game), method: :delete, class: "btn btn-favorite-d-custom-show" do %>
                  お気に入り登録済み <i class="fa-solid fa-heart"></i>
                <% end %>
              <% else %>
                <%= link_to game_favorites_path(@game), method: :post, class: "btn btn-favorite-custom-show" do %>
                  お気に入り登録済み <i class="fa-regular fa-heart"></i>
                <% end %>
              <% end %>
            <% end %>
          </div>
          <table class="table game-date-table">
            <tbody>
              <tr>
                <th>ジャンル</th>
                <td><%= @game.genre %></td>
              </tr>
              <tr>
                <th>対応機種</th>
                <td><%= @game.status %></td>
              </tr>
              <tr>
                <th>価格</th>
                <td><%= @game.price %>円</td>
              </tr>
              <tr>
                <th>開発元</th>
                <td><%= @game.developer %></td>
              </tr>
              <tr>
                <th>リリース日</th>
                <td><%= @game.release_date %></td>
              </tr>
              <tr>
                <th>課金情報</th>
                <td><%= @game.payment_details %></td>
              </tr>
            </tbody>
          </table>
        <% if user_signed_in? %>
          <% if current_user.admin? %>
            <div class="game-info-update">
              <%= link_to edit_game_path(@game), class: 'btn btn-outline-dark rounded-pill btn-block' do %>
                ゲーム情報を編集する <i class="fa-regular fa-pen-to-square"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>
        </section>
      </div>
      <div class="col-md-6">
        <section class="new-review-form section-back mt-3">
          <%= form_with(model:[@game, @review], local: true) do |f| %>
            <h3 class="font-al">New Review</h3>
            <p class="font-jp"><%= link_to @game.title, game_path(@game) %>のレビューを送信してください</p>
            <div class="form-radiobox">
              <%= f.radio_button :rating, "5", class: 'radiobutton' %>
              <label for="review_rating_5"><i class="fa-solid fa-face-laugh-squint"> Excellent</i></label>
              <%= f.radio_button :rating, "4", class: 'radiobutton' %>
              <label for="review_rating_4"><i class="fa-solid fa-face-smile"> Good</i></label>
              <%= f.radio_button :rating, "3", class: 'radiobutton' %>
              <label for="review_rating_3"><i class="fa-solid fa-face-meh"> Average</i></label>
              <%= f.radio_button :rating, "2", class: 'radiobutton' %>
              <label for="review_rating_2"><i class="fa-solid fa-face-frown-open"> Below Average</i></label>
              <%= f.radio_button :rating, "1", class: 'radiobutton' %>
              <label for="review_rating_1"><i class="fa-solid fa-face-sad-tear"> Poor</i></label>
            </div>
            <div class="form-group">
              <%= f.text_area :comment, class: 'form-control',placeholder: "感想、コメントを記入" %>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-block btn-success">レビューを送信</button>
            </div>
          <% end %>
        </section>
      </div>
    </div>
    <div class="row d-flex">
      <div class="col-12">
        <section class="review-index section-back mt-3">
          <h3 class="font-al">Game's Review</h3>
          <% if @reviews.any? %>
          <div class="review-cards">
            <% @reviews.each do |review| %>
              <div class="card m-3 p-3">
                <h4><%= link_to display_rating_icon(review.rating), game_review_path(review.game, review) %></h4>
                <p class="review-text mt-1 font-jp"><%= review.comment %></p>
                <p><%= review.user.name %>_ <%= review.created_at.strftime('%Y/%m/%d') %></p>
              </div>
            <% end %>
          </div>
          <% else %>
              <p class="font-jp">レビューはまだありません。</p>
          <% end %>
        </section>
      </div>
    </div>
  </div>
</main>